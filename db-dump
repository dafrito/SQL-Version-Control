#!/bin/bash
# Updates a database by running patches
PATH=/bin:/usr/bin:$HOME/bin:${0%/*}

. db-load-settings.sh;
. db-get-password.sh;

function get_history {
    if ! mysql $db -u "$user" -p"$PASSWORD" -e"select table_name,type,order_applied from patch_history" -N; then
        exit 2
    fi;
}

get_history | db-get-installed-tables.awk | xargs mysqldump $db -u "$user" -p"$PASSWORD" --skip-dump-date --no-data;
