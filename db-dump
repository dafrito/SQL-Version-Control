#!/bin/bash
# Updates a database by running patches
PATH=/bin:/usr/bin:$HOME/bin:${0%/*}

source db-load-settings.sh;
source db-get-password.sh;

function get_history {
    if ! mysql $db -u "$user" -p"$PASSWORD" -e"select table_name,type,order_applied from patch_history" -N; then
        exit 2
    fi;
}

get_history | awk -f db-get-installed-tables.awk | \
xargs mysqldump $db -u "$user" -p"$PASSWORD" --skip-dump-date --no-data;
